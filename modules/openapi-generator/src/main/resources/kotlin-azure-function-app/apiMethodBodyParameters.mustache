{{#bodyParam}}val {{#bodyParam}}{{paramName}}{{/bodyParam}} = request.body {{/bodyParam}}

{{#queryParams}}
val {{paramName}} = request.queryParameters["{{paramName}}"]{{#isArray}}?.split(",")?.toTypedArray() ?: emptyArray(){{/isArray}}{{^isArray}}{{#defaultValue}} ?: {{defaultValue}}{{/defaultValue}}{{^defaultValue}}{{/defaultValue}}{{/isArray}}
{{/queryParams}}

{{#headerParams}}
  val {{paramName}} = request.request.headers["{{paramName}}"]{{#defaultValue}} ?: {{defaultValue}}{{/defaultValue}}{{^defaultValue}}{{/defaultValue}}
{{/headerParams}}


val notSetRequiredParams = mutableSetOf<String>()

{{#allParams}}
{{^defaultValue}}{{#required}}{{paramName}} ?: run{ notSetRequiredParams.add("{{paramName}}") }
{{/required}}{{/defaultValue}}
{{/allParams}}

if(notSetRequiredParams.isNotEmpty()) {
  return request
    .createResponseBuilder(HttpStatus.BAD_REQUEST)
    .body("Required parameters missing: ${notSetRequiredParams.joinToString { ", " }}")
    .build()
}

